<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Super Mario 2D</title>
    <style>
        body{
            margin: 0;
            background-color: cornflowerblue;

        }
        #terreno{
            background-image: url('mattoncinoSuperMario2D.png');
            width: 620px; height: 120px;
            margin-top: 33em;
            
        }
        #terreno2{
            background-image: url('mattoncinoSuperMario2D.png');
            height: 120px; width: 1500px;
        }
        img{
            position: absolute;
            width: 1900px; height: 120px;
            margin-top: -33em;
        }
        #superMario{
            background-image: url('superMario2D.png');
            height: 66px;
            width: 50px;
            position: absolute;
            top: 465px;

        }
        p{
            margin: 1em;
            margin-top: -30em;
            color: white;
            font-size: 20px;
        }
    </style>
    <script>
        "use strict";
        let superMarioX = 0;
        let superMarioY;
        let superMario;
        let gravitaTimer;
        function avviaTimer(){
            superMario = document.getElementById("superMario");
            superMarioY = parseInt(window.getComputedStyle(superMario).top); 
            console.log(superMarioY);

            // fa partire la canzone
            let player = document.getElementById("themeSong");
            console.log(player);
            player.play();

            gravitaTimer = setInterval(gravita, 30);
        }
        let altezzaSalto=80; // Altezza del salto
        function pigiato(evento){
            if(evento.key == 'w' || evento.key == ' '){
                if(verificaCollisione()){
                    // Salto verso l'alto
                    superMarioY -= altezzaSalto;
                    superMario.style.top = superMarioY + "px";
                    setTimeout(abbassa,durataSalto);
                }
                let durataSalto = 300;
            }
	        if(evento.key == 's'){
                if (!verificaCollisione()) {
                        superMarioY += 10;
                        superMario.style.top = superMarioY + "px";    
                }
            }
	        if(evento.key == 'a'){
                superMarioX-=10; superMario.style.left = superMarioX +"px";
            }
	        if(evento.key == 'd'){ 
                superMarioX+=10; superMario.style.left = superMarioX +"px";
                window.scrollTo(superMarioX - window.innerWidth / 2, superMarioY);
            }
        }
        function abbassa(){
            superMarioY+=altezzaSalto;
            superMario.style.top = superMarioY + "px";
        }
        function verificaCollisione() {
            let marioRect = superMario.getBoundingClientRect();
            let terreno1 = document.getElementById("terreno").getBoundingClientRect();
            let terreno2 = document.getElementById("terreno2").getBoundingClientRect();

            return (verificaSingolaCollisione(marioRect, terreno1) || verificaSingolaCollisione(marioRect, terreno2));
        }
        function verificaSingolaCollisione(rect1, rect2) {
            return !(
                rect1.bottom < rect2.top ||
                rect1.top > rect2.bottom ||
                rect1.right < rect2.left ||
                rect1.left > rect2.right
            );
        }
        function gravita() {
            if (!verificaCollisione()) {
                superMarioY += 5; // velocit√† di caduta
                superMario.style.top = superMarioY + "px";
            }
        }

    </script>
</head>
    <body onkeydown="pigiato(event)" onload="avviaTimer()" >
        <div id="superMario"></div>
        <div id="terreno"></div>
        <div id="terreno2"></div>
        <img src="cieloSuperMario2D.png" alt="cielo" >
        <audio src="Super Mario Bros. Theme Song.mp3" id="themeSong" ></audio>
    </body>
</html>